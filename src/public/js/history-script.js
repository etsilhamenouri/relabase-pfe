window.onload = function() {
  makeTableSortable("history-table");
  dateSearchFunction("history-date-from-search", "history-date-to-search", "history-table", 0);
  searchFunction("history-search-from", "history-table", 1); 
  enforceDateFormat(document.getElementById('history-date-from-search'));
  enforceDateFormat(document.getElementById('history-date-to-search'));

  const scriptTextbox = document.querySelector('.script-textbox');
  const lineNumberElement = document.querySelector('.line-numbers');
  
  scriptTextbox.addEventListener('scroll', () => {
    lineNumberElement.scrollTop = scriptTextbox.scrollTop;
  });
}

function updateLineNumbers(script, lineNumberElement) {
  const lines = script.split('\n');
  lineNumberElement.innerText = lines.map((_, i) => i + 1 + '.').join('\n');
}

var tableRows = document.querySelectorAll('#history-table .table-row');
tableRows.forEach(function(row) {
  row.addEventListener('click', function() {
    var timestamp = row.children[0].textContent.trim();
    var userFullName = row.children[1].textContent.trim();
    var scriptData = row.getAttribute('data-text');
  
    document.querySelector('#modal-title').textContent = 'R Script generated by ' + userFullName + ' on ' + timestamp;
    var scriptTextbox = document.querySelector('.script-textbox');
    scriptTextbox.textContent = scriptData;
    var lineNumberElement = document.querySelector('.line-numbers');
    updateLineNumbers(scriptData, lineNumberElement);
    document.querySelector('#modal').style.display = 'flex';
  });
});

document.querySelector('#close-modal').addEventListener('click', function() {
  document.querySelector('#modal').style.display = 'none';
});

document.getElementById('modal').addEventListener('click', function(event) {
  if (event.target == this) {
      this.style.display = "none";
  }
});

document.getElementById('close-modal').addEventListener('click', function() {
  document.getElementById('modal').style.display = "none";
});
